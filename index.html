<!DOCTYPE html>
<html lang="en">

<head>
    <title>Pertandingan Dashboard dengan Login</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .fixed-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .score-buttons button {
            margin: 2px;
            width: 35px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
        }

        @media (max-width: 800px) {
            .full-width-modal {
                max-width: 100%;
                margin: 10px;
                /* Tambahkan margin agar tidak terlalu rapat ke tepi layar */
            }
        }

        /* @media (max-width: 768px) {
            table {
                font-size: 12px;
            }
            table th, table td {
                padding: 5px;
                white-space: nowrap;
            }
            .score-buttons button {
                width: 30px;
                font-size: 12px;
            }
            .fixed-button {
                width: 50px;
                height: 50px;
                font-size: 12px;
            }
            .btn-block {
                font-size: 14px;
                padding: 8px;
            }
            h2, h3 {
                font-size: 16px;
            }
            .modal-dialog {
                max-width: 90%;
            }
            .login-container {
                width: 90%;
            }
        } */
    </style>
</head>

<body>

    <div id="app" class="container mt-3">

        <div v-if="!isLoggedIn" class="login-container">
            <h4 class="text-center">Login</h4>
            <input type="text" class="form-control mb-2" placeholder="Username" v-model="username">
            <input type="password" class="form-control mb-2" placeholder="Password" v-model="password">
            <button class="btn btn-primary btn-block" @click="checkLogin">Login</button>
        </div>

        <div v-if="isLoggedIn">

            <div class="container mt-4">
                <h2 class="text-center">Dashboard Pertandingan TTC {{lokasi}} </h2>
                <h3 class="text-center">start 10 Maret 2025</h3>

                <div class="btn-group w-100 shadow-sm my-2">
                    <button @click="statistik = !statistik" class="btn btn-outline-primary">
                        üìä Statistik Pemain
                    </button>
                    <button @click="pasangan = !pasangan" class="btn btn-outline-success">
                        üë• Statistik Pasangan
                    </button>
                    <button @click="head2 = !head2" class="btn btn-outline-warning">
                        ‚öîÔ∏è H2H (Head to Head)
                    </button>
                    <button @click="head2pas = !head2pas" class="btn btn-outline-danger">
                        üèÜ H2H Pasangan
                    </button>
                </div>
                
                <!-- statistik pasangan -->
                <div class="container" v-if="pasangan">
                    <h2>Statistik Pasangan</h2>
                    <!-- {{player1}},{{player2}},{{player3}},{{player4}}, pasangan : {{recordPasangan}} -->
                    <div class="container p-3">
                        <div class="row">
                            <!-- Tim 1 -->
                            <div class="col-6">
                                    <div class="d-flex">
                                        <div class="row">
                                            <div class="col-6">
                                                <select v-model="player1" class="form-select  form-control">
                                                    <option value="" disabled selected>Pilih Player 1</option>
                                                    <option v-for="name in availablePlayers(1)" :key="name" :value="name">{{
                                                        name }}</option>
                                                </select>
                                            </div>
                                            <div class="col-6">
                                                <select v-model="player2" class="form-select  form-control">
                                                    <option value="" disabled selected>Pilih Player 2</option>
                                                    <option v-for="name in availablePlayers(2)" :key="name" :value="name">{{
                                                        name }}</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="statistikPasangan" class="card p-3 shadow-sm">
                        <h5 class="text-center text-primary">Statistik Pasangan</h5>
                        
                        <p class="text-center">
                            <strong>(Menang: {{ statistikPasangan.menang }} | Kalah: {{ statistikPasangan.kalah }})</strong>
                        </p>
                    
                        <p>
                            <strong>Paling banyak kalah ketika melawan pasangan:</strong> 
                            {{ statistikPasangan.pasanganTersulit }}
                        </p>
                    
                        <p>
                            <strong>Paling banyak kalah ketika melawan (1 pemain):</strong> 
                            {{ statistikPasangan.individuTersulit }}
                        </p>
                    
                        <p>
                            <strong>Paling banyak menang ketika melawan pasangan:</strong> 
                            {{ statistikPasangan.pasanganPalingDikalahkan }}
                        </p>
                    
                        <!-- Tabel Riwayat Pertandingan -->
                        <div v-if="statistikPasangan.riwayat.length">
                            <h6 class="mt-3">Riwayat Pertandingan</h6>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Tanggal</th>
                                        <th>Pasangan</th>
                                        <th>Skor</th>
                                        <th>Lawan</th>
                                        <th>Hasil</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(match, index) in statistikPasangan.riwayat" :key="match.id">
                                        <td>{{ index + 1 }}</td>
                                        <td>{{ new Date(match.tanggal).toLocaleDateString() }}</td>
                                        <td>{{ match.pasangan }}</td>
                                        <td>{{ match.skorTim1 }} - {{ match.skorTim2 }}</td>
                                        <td>{{ match.lawan }}</td>
                                        <td>
                                            <span class="badge" 
                                                  :class="match.menang ? 'bg-success' : 'bg-danger'">
                                                {{ match.menang ? 'Menang' : 'Kalah' }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    

<!-- {{datapasangan}} -->


                

                    <div v-if="hasilAnalisis" class="container mt-4">
                        <div class="card shadow-lg">
                            <div class="card-header bg-primary text-white text-center">
                                <h4 class="mb-0">Analisis Head-to-Head</h4>
                            </div>
                            <div class="card-body text-center">
                                <h5>Total Pertandingan: <strong>{{ hasilAnalisis.totalPertandingan }}</strong></h5>
                                <h3 class="my-3">
                                    <span class="fw-bold">{{ hasilAnalisis.namaTim1 }}</span>
                                    <span class="badge bg-danger fs-5 px-3 py-2 mx-2">{{ hasilAnalisis.tim1Menang }} vs
                                        {{ hasilAnalisis.tim2Menang }}</span>
                                    <span class="fw-bold">{{ hasilAnalisis.namaTim2 }}</span>
                                </h3>
                            </div>

                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Tim 1</th>
                                        <th>Skor</th>
                                        <th>Tim 2</th>
                                        <th>Lokasi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="match in hasilAnalisis.pertandingan" :key="match.id">
                                        <td>{{ new Date(match.tanggal).toLocaleDateString() }}</td>
                                        <td><strong>{{ match.namaPemainTim1 }}</strong></td>
                                        <td><span class="badge bg-warning fs-6">{{ match.skorTim1 }} - {{ match.skorTim2
                                                }}</span></td>
                                        <td><strong>{{ match.namaPemainTim2 }}</strong></td>
                                        <td>{{ match.lokasi }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>



                    <br><br><br><br>

                </div>


                <!-- h2h pas -->
                <div class="container" v-if="head2pas">
                    <h2>Head 2 Head Pasangan</h2>
                    <!-- {{player1}},{{player2}},{{player3}},{{player4}}, pasangan : {{recordPasangan}} -->
                    <div class="container p-3">
                        <div class="row">
                            <!-- Tim 1 -->
                            <div class="col-md-6">
                                <div class="card shadow-sm p-3">
                                    <h5 class="card-title text-center text-primary">Tim 1</h5>

                                    <div class="mb-3">
                                        <select v-model="player1" class="form-select  form-control">
                                            <option value="" disabled selected>Pilih Player 1</option>
                                            <option v-for="name in availablePlayers(1)" :key="name" :value="name">{{
                                                name }}</option>
                                        </select>
                                    </div>

                                    <div>
                                        <select v-model="player2" class="form-select  form-control">
                                            <option value="" disabled selected>Pilih Player 2</option>
                                            <option v-for="name in availablePlayers(2)" :key="name" :value="name">{{
                                                name }}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Tim 2 -->
                            <div class="col-md-6">
                                <div class="card shadow-sm p-3">
                                    <h5 class="card-title text-center text-danger">Tim 2</h5>

                                    <div class="mb-3">
                                        <select v-model="player3" class="form-select  form-control">
                                            <option value="" disabled selected>Pilih Player 3</option>
                                            <option v-for="name in availablePlayers(3)" :key="name" :value="name">{{
                                                name }}</option>
                                        </select>
                                    </div>

                                    <div>
                                        <select v-model="player4" class="form-select  form-control">
                                            <option value="" disabled selected>Pilih Player 4</option>
                                            <option v-for="name in availablePlayers(4)" :key="name" :value="name">{{
                                                name }}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>




                    <div class="text-center">
                        <button @click="resetPlayers" class="btn btn-danger mt-3">Reset</button>
                    </div>

                    <div v-if="hasilAnalisis" class="container mt-4">
                        <div class="card shadow-lg">
                            <div class="card-header bg-primary text-white text-center">
                                <h4 class="mb-0">Analisis Head-to-Head</h4>
                            </div>
                            <div class="card-body text-center">
                                <h5>Total Pertandingan: <strong>{{ hasilAnalisis.totalPertandingan }}</strong></h5>
                                <h3 class="my-3">
                                    <span class="fw-bold">{{ hasilAnalisis.namaTim1 }}</span>
                                    <span class="badge bg-danger fs-5 px-3 py-2 mx-2">{{ hasilAnalisis.tim1Menang }} vs
                                        {{ hasilAnalisis.tim2Menang }}</span>
                                    <span class="fw-bold">{{ hasilAnalisis.namaTim2 }}</span>
                                </h3>
                            </div>

                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Tim 1</th>
                                        <th>Skor</th>
                                        <th>Tim 2</th>
                                        <th>Lokasi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="match in hasilAnalisis.pertandingan" :key="match.id">
                                        <td>{{ new Date(match.tanggal).toLocaleDateString() }}</td>
                                        <td><strong>{{ match.namaPemainTim1 }}</strong></td>
                                        <td><span class="badge bg-warning fs-6">{{ match.skorTim1 }} - {{ match.skorTim2
                                                }}</span></td>
                                        <td><strong>{{ match.namaPemainTim2 }}</strong></td>
                                        <td>{{ match.lokasi }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>



                    <br><br><br><br>

                </div>



                <div class="container" v-if="head2">
                    <h2>Head 2 Head Pemain</h2>
                    <hr />

                    <!-- Input Pemain 1 & 2 -->
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="form-group">
                            <label for="player1">Pemain 1</label>
                            <select v-model="player1" class="form-control">
                                <option value="">Pilih Pemain</option>
                                <option v-for="player in sortedAvailablePlayers" :key="player" :value="player">{{ player
                                    }}</option>
                            </select>
                        </div>

                        <div class="px-3 fw-bold">VS</div>

                        <div class="form-group">
                            <label for="player2">Pemain 2</label>
                            <select v-model="player2" class="form-control" :disabled="!player1">
                                <option value="">Pilih Pemain</option>
                                <option v-for="player in availablePlayersForPlayer2" :key="player" :value="player">{{
                                    player }}</option>
                            </select>
                        </div>
                    </div>

                    <!-- <button class="btn btn-primary mt-3" @click="hitungH2H" :disabled="!player1 || !player2">
                      Analisis
                    </button> -->

                    <div v-if="headToHeadSummary">
                        <div class="container text-center" v-if="head2">
                            <!-- Total Pertandingan & Kemenangan -->
                            <div class="my-3">
                                <h3>Total Pertandingan: {{ headToHeadSummary.total/2 }}</h3>
                                <h4>{{ player1 }} : {{ headToHeadSummary.player1Wins }} vs {{
                                    headToHeadSummary.player2Wins }} : {{ player2 }}</h4>

                            </div>

                            <!-- Informasi pasangan terbaik dan terburuk sejajar -->
                            <div class="row mt-4">
                                <!-- Kolom untuk Player 1 -->
                                <div class="col-md-6 border-end">
                                    <h3 class="fw-bold">{{ player1 }}</h3>
                                    <p class="text-success">‚úÖ Paling banyak menang saat berpasangan dengan:</p>
                                    <h5 class="text-primary">{{ headToHeadSummary.bestPartnerPlayer1 }}</h5>
                                    <p class="text-danger">‚ùå Paling banyak kalah saat berpasangan dengan:</p>
                                    <h5 class="text-warning">{{ headToHeadSummary.worstPartnerPlayer1 }}</h5>
                                </div>

                                <!-- Kolom untuk Player 2 -->
                                <div class="col-md-6">
                                    <h3 class="fw-bold">{{ player2 }}</h3>
                                    <p class="text-success">‚úÖ Paling banyak menang saat berpasangan dengan:</p>
                                    <h5 class="text-primary">{{ headToHeadSummary.bestPartnerPlayer2 }}</h5>
                                    <p class="text-danger">‚ùå Paling banyak kalah saat berpasangan dengan:</p>
                                    <h5 class="text-warning">{{ headToHeadSummary.worstPartnerPlayer2 }}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br><br><br><br>
                </div>







                <div v-if="statistik">


                    <div class="container">
                        <h2>Statistik Pemain</h2>
                        <label for="playerSelect">Pilih Pemain:</label>
                        <select v-model="selectedPlayer" id="playerSelect">
                            <option value="">-- Pilih Pemain --</option>
                            <option v-for="player in sortedPlayers" :value="player">{{ player }}</option>
                        </select>
                        <label>Pilih Tahun:</label>
                        <select v-model="selectedYear">
                            <option v-for="year in availableYears" :key="year" :value="year">{{ year }}</option>
                        </select>

                        <label>Pilih Bulan:</label>
                        <select v-model="selectedMonth">
                            <option value="">all</option>
                            <option v-for="month in availableMonths" :key="month" :value="month">{{ month }}</option>
                        </select>
                        <div v-if="totalWins">
                            <h3>(Menang: {{ totalWins }} | <span style="color: red;"> Kalah: {{ totalLosses }}</span>)
                            </h3>
                            <p class="text-primary">Paling banyak menang saat berpasangan:<strong> {{ topWinningPartner
                                    }}</strong></p>
                            <p>Paling banyak kalah saat berpasangan dengan :<strong> {{ topLosingPartner }}</strong></p>
                            <p>Paling banyak kalah ketika melawan pasangan:<strong> {{ topLosingOpponentPair }}</strong>
                            </p>
                            <p>Paling banyak kalah ketika melawan (1 pemain):<strong> {{ topLosingOpponent }}</strong>
                            </p>

                        </div>
                    </div>





                    <div class="table-responsive" v-if="dashboardMatches1.length > 0">
                        <table class="table table-bordered table-striped table-hover table-sm">
                            <thead class="thead-dark">
                                <tr>
                                    <th>No</th>
                                    <th>Tanggal</th>
                                    <th>Pemain Tim 1</th>
                                    <th>Skor 1</th>
                                    <th>Skor 2</th>
                                    <th>Pemain Tim 2</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(match, index) in dashboardMatches1" :key="index">
                                    <td>{{ index + 1 }}</td>
                                    <td>{{ formatTanggal(match.tanggal) }}</td>
                                    <td :class="{ 'text-danger': match.skorTim1 < match.skorTim2 }">{{
                                        match.namaPemainTim1 }}</td>
                                    <td :class="{ 'text-danger': match.skorTim1 < match.skorTim2 }">{{ match.skorTim1 }}
                                    </td>
                                    <td :class="{ 'text-danger': match.skorTim2 < match.skorTim1 }">{{ match.skorTim2 }}
                                    </td>
                                    <td :class="{ 'text-danger': match.skorTim2 < match.skorTim1 }">{{
                                        match.namaPemainTim2 }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br><br><br><br>
                </div>

                <hr>
                <!-- {{AlldashboardMatches}} -->
                <h3 class="mt-4">Riwayat Pertandingan</h3>
                <div class="table-responsive" v-if="dashboardMatches.length > 0">
                    <table class="table table-bordered table-striped table-hover table-sm">
                        <thead class="thead-dark">
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Pemain Tim 1</th>
                                <th>Skor 1</th>
                                <th>Skor 2</th>
                                <th>Pemain Tim 2</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(match, index) in AlldashboardMatches" :key="index">
                                <td>{{ index + 1 }}</td>
                                <td>{{ formatTanggal(match.tanggal) }}</td>
                                <td>{{ match.namaPemainTim1 }}</td>
                                <td>{{ match.skorTim1 }}</td>
                                <td>{{ match.skorTim2 }}</td>
                                <td>{{ match.namaPemainTim2 }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="mt-4">Riwayat Performa Pemain</h3>
                <!-- {{playerRecords}} -->
                <div class="table-responsive">
                    <table class="table table-striped table-sm">
                        <thead class="thead-light">
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Pemain</th>
                                <th>Pasangan</th>
                                <th>Skor</th>
                                <th>Hasil</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(record, index) in playerRecords" :key="'pr-' + index">
                                <td>{{ index + 1 }}</td>
                                <td>{{ formatTanggal(record.tanggal) }}</td>
                                <td>{{ record.player }}</td>
                                <td>{{ record.pasangan }}</td>
                                <td>{{ record.skor }}</td>
                                <td
                                    :class="{'text-success': record.hasil === 'Menang', 'text-danger': record.hasil === 'Kalah'}">
                                    {{ record.hasil }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="mt-4">Ranking Pemain</h3>
                <div class="table-responsive">
                    <table class="table table-bordered table-sm">
                        <thead class="thead-dark">
                            <tr>
                                <th>Ranking</th>
                                <th>Nama</th>
                                <th>Lokasi</th>
                                <th>Menang</th>
                                <th>Kalah</th>
                                <th>Persentase</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(player, index) in sortedPlayersByPercentage" :key="player.id">
                                <td>{{ index + 1 }}</td>
                                <td>{{ player.nama }}</td>
                                <td>{{ player.lokasi }}</td>
                                <td>{{ player.menang }}</td>
                                <td>{{ player.kalah }}</td>
                                <td>{{ (player['%'] * 100).toFixed(2) }}%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>


            <button class="btn btn-danger fixed-button" @click="openModal()">Rekam</button>

            <div class="modal fade" :class="{'show': showTeamModal}" style="display: block;" v-if="showTeamModal">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable full-width-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Pilih Tim dan Tanggal</h5>
                            <button type="button" class="close" @click="showTeamModal = false">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="matchDate">Tanggal Pertandingan</label>
                                <input type="date" class="form-control" v-model="matchDate">
                            </div>
                            <div class="row">
                                <div class="col-sm-6 mb-2">
                                    <button class="btn btn-primary btn-block" @click="selectTeam('Tim 1')">
                                        Tim 1 <br><small>{{ displayTeamPlayers('Tim 1') }}</small>
                                    </button>
                                </div>
                                <div class="col-sm-6 mb-2">
                                    <button class="btn btn-success btn-block" @click="selectTeam('Tim 2')">
                                        Tim 2 <br><small>{{ displayTeamPlayers('Tim 2') }}</small>
                                    </button>
                                </div>
                            </div>

                            <div class="row mt-3">
                                <div class="col-sm-6 mb-3">
                                    <h5>Skor Tim 1</h5>
                                    <div class="d-flex flex-wrap justify-content-center score-buttons">
                                        <button class="btn btn-outline-primary m-1"
                                            :class="{'btn-primary text-white': scores['Tim 1'] === score}"
                                            v-for="score in 10" :key="'t1-'+score" @click="setScore('Tim 1', score)">
                                            {{ score }}
                                        </button>
                                    </div>
                                </div>
                                <div class="col-sm-6 mb-3">
                                    <h5>Skor Tim 2</h5>
                                    <div class="d-flex flex-wrap justify-content-center score-buttons">
                                        <button class="btn btn-outline-success m-1"
                                            :class="{'btn-success text-white': scores['Tim 2'] === score}"
                                            v-for="score in 10" :key="'t2-'+score" @click="setScore('Tim 2', score)">
                                            {{ score }}
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <button class="btn btn-primary mt-3 btn-block" @click="saveData()">Simpan</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" :class="{'show': showPlayerModal}" style="display: block;" v-if="showPlayerModal">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Pilih Pemain untuk {{ selectedTeam }}</h5>
                            <button type="button" class="close" @click="showPlayerModal = false">&times;</button>
                        </div>
                        <div class="modal-body">
                            <button class="btn btn-outline-secondary btn-block mb-2"
                                v-for="player in sortedAvailablePlayers" :key="player" @click="addPlayerToTeam(player)">
                                {{ player }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                isLoggedIn: true,
                statistik: false,
                head2: false,
                head2pas: false,
                pasangan:true,
                username: '',
                password: '',
                showTeamModal: false,
                showPlayerModal: false,
                matchDate: new Date().toISOString().slice(0, 10),
                selectedTeam: '',
                teams: { 'Tim 1': [], 'Tim 2': [] },
                scores: { 'Tim 1': null, 'Tim 2': null },
                dashboardMatches: [],
                allPlayers1: [{ "id": 1, "nama": "Kukuh", "row": 2 }, { "id": 2, "nama": "Misbach", "row": 3 }, { "id": 3, "nama": "Ape", "row": 4 }, { "id": 4, "nama": "Idur", "row": 5 }, { "id": 5, "nama": "Nurdin", "row": 6 }, { "id": 6, "nama": "Taufik", "row": 7 }],
                playerRecords: [],  // <--- Tambahkan untuk menyimpan data per pemain
                lokasi: 'Surabaya',
                selectedPlayer: "",
                selectedYear: new Date().getFullYear(), // Tahun default sekarang
                selectedMonth: "", // Bulan kosong (berarti semua bulan)
                player1: "",
                player2: "",

                player3: "",
                player4: "",
            },
            computed: {
                statistikPasangan() {
        if (!this.datapasangan.length) return null;

        let menang = 0;
        let kalah = 0;
        let lawanPasanganMenang = {};
        let lawanPasanganKalah = {};
        let lawanIndividuKalah = {};
        let riwayat = [];

        this.datapasangan.forEach(match => {
            const pasanganDiTim1 = match.namaPemainTim1.includes(this.player1) && match.namaPemainTim1.includes(this.player2);
            const pasanganDiTim2 = match.namaPemainTim2.includes(this.player1) && match.namaPemainTim2.includes(this.player2);
            
            if (pasanganDiTim1 || pasanganDiTim2) {
                const isMenang = (pasanganDiTim1 && match.skorTim1 > match.skorTim2) || 
                                 (pasanganDiTim2 && match.skorTim2 > match.skorTim1);
                const pasangan = pasanganDiTim1 ? match.namaPemainTim1 : match.namaPemainTim2;
                const lawan = pasanganDiTim1 ? match.namaPemainTim2 : match.namaPemainTim1;

                riwayat.push({
                    id: match.id,
                    tanggal: match.tanggal,
                    pasangan,
                    skorTim1: match.skorTim1,
                    skorTim2: match.skorTim2,
                    lawan,
                    menang: isMenang
                });

                if (isMenang) {
                    menang += 1;
                    lawanPasanganMenang[lawan] = (lawanPasanganMenang[lawan] || 0) + 1;
                } else {
                    kalah += 1;
                    lawanPasanganKalah[lawan] = (lawanPasanganKalah[lawan] || 0) + 1;

                    lawan.split(", ").forEach(player => {
                        lawanIndividuKalah[player] = (lawanIndividuKalah[player] || 0) + 1;
                    });
                }
            }
        });

        let maxKalahPasangan = Math.max(...Object.values(lawanPasanganKalah), 0);
        let pasanganTersulit = Object.entries(lawanPasanganKalah)
            .filter(([_, count]) => count === maxKalahPasangan)
            .map(([name]) => `${name} (${maxKalahPasangan}x)`)
            .join(", ") || "Tidak ada";

        let maxKalahIndividu = Math.max(...Object.values(lawanIndividuKalah), 0);
        let individuTersulit = Object.entries(lawanIndividuKalah)
            .filter(([_, count]) => count === maxKalahIndividu)
            .map(([name]) => `${name} (${maxKalahIndividu}x)`)
            .join(", ") || "Tidak ada";

        let maxMenangPasangan = Math.max(...Object.values(lawanPasanganMenang), 0);
        let pasanganPalingDikalahkan = Object.entries(lawanPasanganMenang)
            .filter(([_, count]) => count === maxMenangPasangan)
            .map(([name]) => `${name} (${maxMenangPasangan}x)`)
            .join(", ") || "Tidak ada";

        return {
            menang,
            kalah,
            pasanganTersulit,
            individuTersulit,
            pasanganPalingDikalahkan,
            riwayat
        };
    }
    ,
    
    datapasangan() {
        if (!this.player1 || !this.player2) {
            return []; // Jika pemain belum dipilih, kembalikan array kosong
        }

        const pasangan = [this.player1, this.player2].sort().join(", ");

        return this.AlldashboardMatches.filter(match => {
            const tim1 = match.namaPemainTim1.split(", ").sort().join(", ");
            const tim2 = match.namaPemainTim2.split(", ").sort().join(", ");

            return pasangan === tim1 || pasangan === tim2;
        });
    },

                recordPasangan() {
                    if (!this.player1 || !this.player2 || !this.player3 || !this.player4) return [];

                    return this.AlldashboardMatches
                        .filter(match => {
                            // Buat kombinasi pasangan Tim 1
                            const pasangan1 = `${this.player1}, ${this.player2}`;
                            const pasangan2 = `${this.player2}, ${this.player1}`;

                            // Buat kombinasi pasangan Tim 2
                            const pasangan3 = `${this.player3}, ${this.player4}`;
                            const pasangan4 = `${this.player4}, ${this.player3}`;

                            // Cek apakah pasangan1 ada di Tim 1 dan pasangan3 ada di Tim 2 (atau sebaliknya)
                            return (
                                (match.namaPemainTim1 === pasangan1 && match.namaPemainTim2 === pasangan3) ||
                                (match.namaPemainTim1 === pasangan1 && match.namaPemainTim2 === pasangan4) ||
                                (match.namaPemainTim1 === pasangan2 && match.namaPemainTim2 === pasangan3) ||
                                (match.namaPemainTim1 === pasangan2 && match.namaPemainTim2 === pasangan4) ||
                                (match.namaPemainTim1 === pasangan3 && match.namaPemainTim2 === pasangan1) ||
                                (match.namaPemainTim1 === pasangan3 && match.namaPemainTim2 === pasangan2) ||
                                (match.namaPemainTim1 === pasangan4 && match.namaPemainTim2 === pasangan1) ||
                                (match.namaPemainTim1 === pasangan4 && match.namaPemainTim2 === pasangan2)
                            );
                        })
                        .sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal)); // Urutkan DESC
                }
                ,
                analisisPasangan() {
                    if (!this.recordPasangan.length) return null;

                    let totalPertandingan = this.recordPasangan.length;
                    let tim1Menang = 0, tim2Menang = 0;

                    this.recordPasangan.forEach(match => {
                        if (match.skorTim1 > match.skorTim2) {
                            // Tim 1 menang
                            if (match.namaPemainTim1.includes(this.player1) && match.namaPemainTim1.includes(this.player2)) {
                                tim1Menang++;
                            } else {
                                tim2Menang++;
                            }
                        } else {
                            // Tim 2 menang
                            if (match.namaPemainTim1.includes(this.player1) && match.namaPemainTim1.includes(this.player2)) {
                                tim2Menang++;
                            } else {
                                tim1Menang++;
                            }
                        }
                    });

                    return {
                        totalPertandingan,
                        tim1Menang,
                        tim2Menang
                    };
                },
                hasilAnalisis() {
                    if (!this.recordPasangan.length) return null;

                    let tim1Menang = 0, tim2Menang = 0;
                    let namaTim1 = `${this.player1} & ${this.player2}`;
                    let namaTim2 = `${this.player3} & ${this.player4}`;

                    this.recordPasangan.forEach(match => {
                        if (
                            match.namaPemainTim1.includes(this.player1) && match.namaPemainTim1.includes(this.player2) ||
                            match.namaPemainTim2.includes(this.player1) && match.namaPemainTim2.includes(this.player2)
                        ) {
                            if (match.skorTim1 > match.skorTim2) {
                                if (match.namaPemainTim1.includes(this.player1) && match.namaPemainTim1.includes(this.player2)) {
                                    tim1Menang++;
                                } else {
                                    tim2Menang++;
                                }
                            } else if (match.skorTim1 < match.skorTim2) {
                                if (match.namaPemainTim1.includes(this.player1) && match.namaPemainTim1.includes(this.player2)) {
                                    tim2Menang++;
                                } else {
                                    tim1Menang++;
                                }
                            }
                        }
                    });

                    return {
                        namaTim1,
                        namaTim2,
                        tim1Menang,
                        tim2Menang,
                        totalPertandingan: this.recordPasangan.length,
                        pertandingan: this.recordPasangan
                    };
                }
                ,





                headToHeadRecords() {
                    if (!this.player1 || !this.player2) return [];

                    return this.playerRecords.filter(record => {
                        return (
                            (record.player === this.player1 && record.lawan.includes(this.player2)) ||
                            (record.player === this.player2 && record.lawan.includes(this.player1))
                        );
                    });
                },

                headToHeadSummary() {
                    if (!this.player1 || !this.player2) return null;

                    let totalMatches = 0;
                    let player1Wins = 0;
                    let player2Wins = 0;
                    let player1WinPartners = {};
                    let player1LosePartners = {};
                    let player2WinPartners = {};
                    let player2LosePartners = {};

                    this.playerRecords.forEach(record => {
                        // Hanya hitung jika player1 bertanding melawan player2
                        if ((record.player === this.player1 && record.lawan.includes(this.player2)) ||
                            (record.player === this.player2 && record.lawan.includes(this.player1))) {
                            totalMatches++;

                            if (record.player === this.player1) {
                                if (record.hasil === "Menang") {
                                    player1Wins++;
                                    player1WinPartners[record.pasangan] = (player1WinPartners[record.pasangan] || 0) + 1;
                                } else if (record.hasil === "Kalah") {  // Hanya hitung jika kalah
                                    player1LosePartners[record.pasangan] = (player1LosePartners[record.pasangan] || 0) + 1;
                                }
                            }

                            if (record.player === this.player2) {
                                if (record.hasil === "Menang") {
                                    player2Wins++;
                                    player2WinPartners[record.pasangan] = (player2WinPartners[record.pasangan] || 0) + 1;
                                } else if (record.hasil === "Kalah") {  // Hanya hitung jika kalah
                                    player2LosePartners[record.pasangan] = (player2LosePartners[record.pasangan] || 0) + 1;
                                }
                            }
                        }
                    });

                    return {
                        total: totalMatches,
                        player1Wins,
                        player2Wins,
                        bestPartnerPlayer1: this.findMostFrequentPartners(player1WinPartners),
                        worstPartnerPlayer1: Object.keys(player1LosePartners).length > 0
                            ? this.findMostFrequentPartners(player1LosePartners)
                            : "Belum ada data",
                        bestPartnerPlayer2: this.findMostFrequentPartners(player2WinPartners),
                        worstPartnerPlayer2: Object.keys(player2LosePartners).length > 0
                            ? this.findMostFrequentPartners(player2LosePartners)
                            : "Belum ada data"
                    };
                },


                AlldashboardMatches() {
                    return this.dashboardMatches.slice().sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
                },

                dashboardMatches1() {
                    if (!this.selectedPlayer) return [];

                    return this.dashboardMatches
                        .filter(match =>
                            match.namaPemainTim1.includes(this.selectedPlayer) ||
                            match.namaPemainTim2.includes(this.selectedPlayer)
                        )
                        .sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal)); // Urutkan dari terbaru ke terlama
                },

                availableYears() {
                    // Ambil semua tahun unik dari playerRecords
                    let years = [...new Set(this.playerRecords.map(record => new Date(record.tanggal).getFullYear()))];

                    // Tambahkan 2025 jika belum ada
                    if (!years.includes(2025)) {
                        years.push(2025);
                    }

                    // Sortir tahun dari yang terbesar ke terkecil
                    return years.sort((a, b) => b - a);
                },

                availableMonths() {
                    // Tambahkan "00" untuk semua bulan, lalu daftar bulan dari 01 hingga 12
                    return [...Array.from({ length: 12 }, (_, i) => (i + 1).toString().padStart(2, "0"))];
                },
                filteredRecords() {
                    return this.playerRecords.filter(record => {
                        const recordDate = new Date(record.tanggal);
                        const recordYear = recordDate.getFullYear();
                        const recordMonth = (recordDate.getMonth() + 1).toString().padStart(2, "0");

                        return (
                            recordYear === this.selectedYear &&
                            (this.selectedMonth === "" || recordMonth === this.selectedMonth)
                        );
                    });
                },
                totalWins() {
                    return this.filteredRecords.filter(record => record.player === this.selectedPlayer && record.hasil === "Menang").length;
                },
                totalLosses() {
                    return this.filteredRecords.filter(record => record.player === this.selectedPlayer && record.hasil === "Kalah").length;
                },
                topWinningPartner() {
                    return this.getMostFrequentPair("Menang");
                },
                topLosingPartner() {
                    return this.getMostFrequentPair("Kalah");
                },
                topLosingOpponentPair() {
                    return this.getMostFrequentOpponent("Kalah", "lawan");
                },
                topLosingOpponent() {
                    return this.getMostFrequentOpponent("Kalah", "lawan_satu");
                },


                allPlayers() {
                    return this.allPlayers1.map(player => player.nama);
                },
                sortedPlayers() {
                    return this.allPlayers.slice().sort();
                },
                sortedAvailablePlayers() {
                    const selectedPlayers = [...this.teams['Tim 1'], ...this.teams['Tim 2']];
                    return this.sortedPlayers.filter(player => !selectedPlayers.includes(player));
                },
                availablePlayersForPlayer2() {
                    // Hanya filter nama yang tidak sama dengan player1
                    return this.sortedAvailablePlayers.filter(player => player !== this.player1);
                },

                sortedPlayersByPercentage() {
                    return [...this.allPlayers1].sort((a, b) => b['%'] - a['%']);
                },
                sortedPlayersByMenang() {
                    return [...this.allPlayers1].sort((a, b) => b['%'] - a['%']);
                },


            },
            watch: {
                player1() {
                    // Reset player2 ketika player1 berubah
                    this.player2 = "";
                }
            },
            methods: {

                availablePlayers(playerNumber) {
                    const selected = [this.player1, this.player2, this.player3, this.player4];
                    return this.sortedAvailablePlayers.filter(name => !selected.includes(name) || selected[playerNumber - 1] === name);
                }

                ,
                hitungH2H() {
                    console.log("Analisis H2H dilakukan untuk", this.player1, "vs", this.player2);
                },
                findMostFrequentPartners(partnerStats) {
                    let maxCount = 0;
                    let bestPartners = [];

                    for (let partner in partnerStats) {
                        if (partnerStats[partner] > maxCount) {
                            maxCount = partnerStats[partner];
                            bestPartners = [`${partner} (${maxCount}x)`];
                        } else if (partnerStats[partner] === maxCount) {
                            bestPartners.push(`${partner} (${maxCount}x)`);
                        }
                    }

                    return bestPartners.length > 0 ? bestPartners.join(", ") : "Belum ada data";
                },


                resetPlayers() {
                    this.player1 = "";
                    this.player2 = "";
                    this.player3 = "";
                    this.player4 = "";
                },

                getMostFrequentPair(resultType) {
                    const pairs = this.filteredRecords
                        .filter(record => record.player === this.selectedPlayer && record.hasil === resultType)
                        .map(record => record.pasangan);

                    return this.countOccurrences(pairs);
                },
                getMostFrequentOpponent(resultType, key) {
                    const opponents = this.filteredRecords
                        .filter(record => record.player === this.selectedPlayer && record.hasil === resultType)
                        .map(record => {
                            if (key === "lawan_satu") {
                                return record.lawan.split(", ")[0]; // Ambil hanya satu lawan
                            } else {
                                // **SORT PASANGAN LAWAN AGAR URUTAN SELALU KONSISTEN**
                                return record.lawan.split(", ").sort().join(", ");
                            }
                        });

                    return this.countOccurrences(opponents);
                },

                countOccurrences(arr) {
                    const countMap = arr.reduce((acc, item) => {
                        acc[item] = (acc[item] || 0) + 1;
                        return acc;
                    }, {});

                    const maxCount = Math.max(...Object.values(countMap), 0);
                    const mostFrequent = Object.entries(countMap)
                        .filter(([_, count]) => count === maxCount)
                        .map(([name, count]) => `${name} (${count}x)`)
                        .join(", ") || "-";

                    return mostFrequent;
                },







                formatTanggal(tanggal) {
                    if (!tanggal) return '';

                    const date = new Date(tanggal);

                    // Pastikan format YYYY-MM-DD dengan zona waktu lokal
                    return date.toLocaleDateString('id-ID', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        timeZone: 'Asia/Jakarta'
                    }).split('/').reverse().join('-'); // Konversi ke format YYYY-MM-DD
                },
                checkLogin() {
                    if (this.password === '123456') {
                        this.isLoggedIn = true;
                    } else {
                        alert('Password salah');
                    }
                },
                openModal() {
                    this.resetForm();
                    this.showTeamModal = true;
                },
                selectTeam(team) {
                    this.selectedTeam = team;
                    this.showPlayerModal = true;
                },
                addPlayerToTeam(player) {
                    if (this.teams[this.selectedTeam].length < 2) {
                        this.teams[this.selectedTeam].push(player);
                    }
                    if (this.teams[this.selectedTeam].length >= 2) {
                        this.showPlayerModal = false;
                    }
                },
                setScore(team, score) {
                    this.scores[team] = score;
                },
                displayTeamPlayers(team) {
                    return this.teams[team].join(', ') || '-';
                },
                saveData() {
                    const newMatch = {
                        date: this.matchDate,
                        team1Players: [...this.teams['Tim 1']],
                        team1Score: this.scores['Tim 1'],
                        team2Score: this.scores['Tim 2'],
                        team2Players: [...this.teams['Tim 2']]
                    };
                    this.dashboardMatches.push(newMatch);

                    // Generate playerRecords baru dari pertandingan ini saja
                    this.playerRecords = [];

                    this.teams['Tim 1'].forEach(player => {
                        this.playerRecords.push({
                            tanggal: this.matchDate,
                            player: player,
                            pasangan: this.teams['Tim 1'].filter(p => p !== player).join(', ') || '-',
                            lawan: this.teams['Tim 2'].join(', '), // Tambahkan lawan dari Tim 2
                            skor: `${this.scores['Tim 1']} - ${this.scores['Tim 2']}`,
                            hasil: this.scores['Tim 1'] > this.scores['Tim 2'] ? 'Menang' : 'Kalah'
                        });
                    });

                    this.teams['Tim 2'].forEach(player => {
                        this.playerRecords.push({
                            tanggal: this.matchDate,
                            player: player,
                            pasangan: this.teams['Tim 2'].filter(p => p !== player).join(', ') || '-',
                            lawan: this.teams['Tim 1'].join(', '), // Tambahkan lawan dari Tim 1
                            skor: `${this.scores['Tim 2']} - ${this.scores['Tim 1']}`,
                            hasil: this.scores['Tim 2'] > this.scores['Tim 1'] ? 'Menang' : 'Kalah'
                        });
                    });

                    // Kirim ke database
                    this.savePlayerRecordsToDB();
                    this.saveMatchToDB();

                    this.showTeamModal = false;
                    this.resetForm();

                    setTimeout(() => {
                        this.ambilDataMatches();
                        this.ambilDataRecords();
                    }, 2000);
                },


                saveMatchToDB() {
                    const waktu1 = Date.now();

                    const namaPemainTim1 = this.teams['Tim 1'].join(", ");
                    const namaPemainTim2 = this.teams['Tim 2'].join(", ");

                    const lin = `https://script.google.com/macros/s/AKfycbwwd67df19vRqNmxRIsnfyYhqzaMDiDTXHmHHJW7IHiHoWHtGLLLKf-rnqJqTZRkVLw/exec?action=insert&table=matches&data=` +
                        encodeURIComponent(JSON.stringify({
                            id: waktu1,
                            tanggal: this.matchDate,
                            namaPemainTim1: namaPemainTim1,
                            skorTim1: this.scores['Tim 1'],
                            skorTim2: this.scores['Tim 2'],
                            namaPemainTim2: namaPemainTim2,
                            lokasi: this.lokasi  // lokasi ditambahkan di sini
                        }));

                    console.log("Kirim data pertandingan ke DB:", lin);

                    $.ajax({
                        type: "GET",
                        url: lin,
                        crossDomain: true,
                        dataType: "jsonp",
                        // success: function (resultData) {
                        //     console.log("Data pertandingan berhasil disimpan:", resultData);
                        // },
                        // error: function (jqXHR, textStatus, errorThrown) {
                        //     console.error("Gagal menyimpan data pertandingan:", textStatus, errorThrown);
                        //     console.log("Response Text:", jqXHR.responseText);
                        // }
                    });
                },





                resetForm() {
                    this.matchDate = new Date().toISOString().substr(0, 10);
                    this.teams = { 'Tim 1': [], 'Tim 2': [] };
                    this.scores = { 'Tim 1': null, 'Tim 2': null };
                    this.selectedTeam = '';
                    this.selectedPlayer = '';
                },
                savePlayerRecordsToDB() {
                    const playerDataArray = this.playerRecords;
                    console.log(playerDataArray);
                    playerDataArray.forEach((record) => {
                        const waktu1 = Date.now();  // ID unik pakai timestamp

                        // Data yang akan dikirim
                        const tanggal = record.tanggal;
                        const player = record.player;
                        const pasangan = record.pasangan;
                        const skor = record.skor;
                        const hasil = record.hasil;
                        const lawan = record.lawan || "Tidak Diketahui";  // Tambahkan default jika lawan tidak ada

                        const lin = `https://script.google.com/macros/s/AKfycbwwd67df19vRqNmxRIsnfyYhqzaMDiDTXHmHHJW7IHiHoWHtGLLLKf-rnqJqTZRkVLw/exec
?action=insert
&table=records
&data=${encodeURIComponent(JSON.stringify({
                            id: waktu1,
                            tanggal,
                            player,
                            pasangan,
                            skor,
                            hasil,
                            lawan
                        }))}`;

                        $.ajax({
                            type: "GET",
                            url: lin,
                            crossDomain: true,
                            dataType: "jsonp",
                            success: function (response) {
                                console.log("Data berhasil disimpan:", response);
                            },
                            error: function (xhr, status, error) {
                                console.error("Gagal menyimpan data:", error);
                            }
                        });

                        console.log("Mengirim data untuk player:", player);
                    });
                },



                ambilDataPlayer() {
                    this.databaseRiil = [];

                    // var url ="https://script.google.com/macros/s/AKfycbyc7wzSrUGxQhcBN5EfVC-rNRj3wncZJOVTWAChXtSwnrHkGjoaoI91bggme_fUOIP9/exec?action=read&table=query";
                    var url =
                        "https://script.google.com/macros/s/AKfycbwwd67df19vRqNmxRIsnfyYhqzaMDiDTXHmHHJW7IHiHoWHtGLLLKf-rnqJqTZRkVLw/exec?action=read&table=players";

                    let app = this;
                    $.getJSON(url, function (json) {
                        // console.log(json.data);
                        app.allPlayers1 = json.data;
                    });
                },

                ambilDataMatches() {
                    this.dashboardMatches = [];  // Pastikan ada data property allMatches di data()

                    var url = "https://script.google.com/macros/s/AKfycbwwd67df19vRqNmxRIsnfyYhqzaMDiDTXHmHHJW7IHiHoWHtGLLLKf-rnqJqTZRkVLw/exec?action=read&table=matches";

                    let app = this;
                    $.getJSON(url, function (json) {
                        app.dashboardMatches = json.data;
                    });
                    // alert("ok");
                },

                ambilDataRecords() {
                    this.playerRecords = [];  // Pastikan ada data property allRecords di data()

                    var url = "https://script.google.com/macros/s/AKfycbwwd67df19vRqNmxRIsnfyYhqzaMDiDTXHmHHJW7IHiHoWHtGLLLKf-rnqJqTZRkVLw/exec?action=read&table=records";

                    let app = this;
                    $.getJSON(url, function (json) {
                        app.playerRecords = json.data;
                    });
                },
                convertToLocalDate(utcDate) {
                    const localDate = new Date(utcDate + 'T00:00:00Z');
                    return localDate.toLocaleDateString('id-ID', { timeZone: 'Asia/Jakarta' });
                },




            },
            created() {
                this.ambilDataPlayer();
                this.ambilDataMatches();
                this.ambilDataRecords();
            },
        });
    </script>

</body>

</html>
